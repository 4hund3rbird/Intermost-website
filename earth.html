<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>3D Earth - MBBS Colleges Abroad</title>

    <!-- Tailwind CSS CDN (for development only) -->
    <script src="https://cdn.tailwindcss.com "></script>

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css "/>

    <!-- Three.js with matching OrbitControls -->
    <script src="https://cdn.jsdelivr.net/npm/three @0.155.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three @0.155.0/examples/js/controls/OrbitControls.min.js"></script>

    <style>
        /* Same CSS styles you already have — omitted here for brevity */
        /* You can paste your full CSS here or include it from your file */
    </style>
</head>
<body>
    <div id="earth-container">
        <div id="search-box">
            <input type="text" id="search-input" placeholder="Search MBBS colleges..." class="px-3 py-2 border rounded w-64 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <button id="search-btn" class="ml-2 px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition">
                <i class="fas fa-search"></i>
            </button>
        </div>
        <div id="country-selector">
            <h3 class="font-bold mb-2 text-gray-700">Filter by Country:</h3>
            <div id="country-buttons"></div>
        </div>
        <div id="info-panel">
            <span class="close-btn" id="close-info"><i class="fas fa-times"></i></span>
            <div id="college-info"></div>
        </div>
        <div id="loading">
            <div class="spinner"></div>
            <p>Loading 3D Earth...</p>
        </div>
    </div>

    <script>
        // MBBS Colleges Data (from your uploaded file)
        const colleges = [
            {
                name: "Vietnam National University",
                location: "Hanoi, Vietnam",
                coordinates: { lat: 21.0285, lng: 105.8542 },
                flag: "https://flagcdn.com/w20/vn.png ",
                duration: "6 Years",
                fees: "₹1.5 Lakh/Semester",
                eligibility: "50% in PCB, NEET Qualified",
                benefits: [
                    "WHO & MCI Approved",
                    "English Medium",
                    "Low Cost of Living",
                    "Modern Infrastructure",
                    "Cultural Similarities"
                ],
                website: "https://vnu.edu.vn ",
                info: "Vietnam National University offers one of the most affordable MBBS programs in Asia with WHO and MCI recognition."
            },
            {
                name: "Moscow State Medical University",
                location: "Moscow, Russia",
                coordinates: { lat: 55.7512, lng: 37.6184 },
                flag: "https://flagcdn.com/w20/ru.png ",
                duration: "6 Years",
                fees: "₹2.2 Lakh/Semester",
                eligibility: "50% in PCB, NEET Qualified",
                benefits: [
                    "Globally Recognized Degrees",
                    "Advanced Infrastructure",
                    "European Standard Education",
                    "High Quality Training",
                    "Affordable Living Costs"
                ],
                website: "https://msmu.ru ",
                info: "One of Russia's top medical universities with over 240 years of history."
            },
            {
                name: "Tbilisi State Medical University",
                location: "Tbilisi, Georgia",
                coordinates: { lat: 41.7151, lng: 44.8271 },
                flag: "https://flagcdn.com/w20/ge.png ",
                duration: "6 Years",
                fees: "₹2.0 Lakh/Semester",
                eligibility: "50% in PCB, NEET Qualified",
                benefits: [
                    "USMLE Preparation",
                    "European Education Standard",
                    "Safe Environment",
                    "English Medium",
                    "WHO Recognized"
                ],
                website: "https://tsmu.edu ",
                info: "Georgia's leading medical university offering European standard education with English medium instruction."
            },
            {
                name: "Tashkent Medical Academy",
                location: "Tashkent, Uzbekistan",
                coordinates: { lat: 41.2995, lng: 69.2401 },
                flag: "https://flagcdn.com/w20/uz.png ",
                duration: "5 Years",
                fees: "₹1.8 Lakh/Semester",
                eligibility: "50% in PCB, NEET Qualified",
                benefits: [
                    "5-Year Direct MD Program",
                    "Low Tuition Fees",
                    "Modern Facilities",
                    "MCI Approved",
                    "English Medium"
                ],
                website: "https://tma.uz ",
                info: "Offers a direct 5-year MD program (equivalent to MBBS) with modern teaching methods and facilities."
            },
            {
                name: "Kathmandu Medical College",
                location: "Kathmandu, Nepal",
                coordinates: { lat: 27.7172, lng: 85.3240 },
                flag: "https://flagcdn.com/w20/np.png ",
                duration: "5.5 Years",
                fees: "₹2.5 Lakh/Semester",
                eligibility: "50% in PCB, NEET Qualified",
                benefits: [
                    "Similar Culture & Environment",
                    "No Language Barrier",
                    "MCI Recognized",
                    "Affordable Fees",
                    "Easy Travel to India"
                ],
                website: "https://kmc.edu.np ",
                info: "One of Nepal's premier medical institutions offering quality education with cultural similarities to India."
            },
            {
                name: "Baku Medical University",
                location: "Baku, Azerbaijan",
                coordinates: { lat: 40.4093, lng: 49.8671 },
                flag: "https://flagcdn.com/w20/az.png ",
                duration: "6 Years",
                fees: "₹2.1 Lakh/Semester",
                eligibility: "50% in PCB, NEET Qualified",
                benefits: [
                    "European Standard Education",
                    "English Medium",
                    "Affordable Fees",
                    "WHO Recognized",
                    "Modern Teaching Methods"
                ],
                website: "https://amu.edu.az ",
                info: "Azerbaijan's leading medical university offering European standard education with English as the medium of instruction."
            }
        ];

        let scene, camera, renderer, earth, controls;
        const markers = [];
        let raycaster = new THREE.Raycaster();
        let mouse = new THREE.Vector2();
        let activeCountry = null;

        document.addEventListener('DOMContentLoaded', () => {
            init();
        });

        function init() {
            try {
                // Scene Setup
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x000000);

                // Camera Setup
                camera = new THREE.PerspectiveCamera(
                    75,
                    window.innerWidth / window.innerHeight,
                    0.1,
                    1000
                );
                camera.position.z = 2;

                // Renderer Setup
                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.getElementById("earth-container").appendChild(renderer.domElement);

                // Controls
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.minDistance = 1.5;
                controls.maxDistance = 5;
                controls.autoRotate = true;
                controls.autoRotateSpeed = 0.5;

                // Lights
                const ambientLight = new THREE.AmbientLight(0x404040);
                scene.add(ambientLight);

                const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
                directionalLight.position.set(1, 1, 1).normalize();
                scene.add(directionalLight);

                // Earth Geometry
                const geometry = new THREE.SphereGeometry(1, 64, 64);
                const textureLoader = new THREE.TextureLoader();

                const earthTexture = textureLoader.load("https://threejs.org/examples/textures/planets/earth_atmos_2048.jpg ");
                const bumpMap = textureLoader.load("https://threejs.org/examples/textures/planets/earth_normal_2048.jpg ");
                const specularMap = textureLoader.load("https://threejs.org/examples/textures/planets/earth_specular_2048.jpg ");

                const material = new THREE.MeshPhongMaterial({
                    map: earthTexture,
                    bumpMap: bumpMap,
                    bumpScale: 0.05,
                    specularMap: specularMap,
                    specular: new THREE.Color("grey"),
                    shininess: 5
                });

                earth = new THREE.Mesh(geometry, material);
                scene.add(earth);

                addStars();
                addCollegeMarkers();
                createCountrySelector();

                document.getElementById("loading").style.display = "none";

                // Events
                window.addEventListener("resize", onWindowResize);
                renderer.domElement.addEventListener("click", onCanvasClick);
                document.getElementById("close-info").addEventListener("click", () => {
                    document.getElementById("info-panel").style.display = "none";
                });
                document.getElementById("search-btn").addEventListener("click", searchCollege);
                document.getElementById("search-input").addEventListener("keypress", (e) => {
                    if (e.key === "Enter") searchCollege();
                });

                animate();
            } catch (error) {
                console.error("Initialization failed:", error);
                document.getElementById("loading").innerHTML = "<p>Error loading 3D Earth. Check console for details.</p>";
            }
        }

        function addStars() {
            const starsGeometry = new THREE.BufferGeometry();
            const starsMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.02 });

            const starVertices = [];
            for (let i = 0; i < 10000; i++) {
                const x = (Math.random() - 0.5) * 2000;
                const y = (Math.random() - 0.5) * 2000;
                const z = (Math.random() - 0.5) * 2000;
                starVertices.push(x, y, z);
            }

            starsGeometry.setAttribute("position", new THREE.Float32BufferAttribute(starVertices, 3));
            const stars = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(stars);
        }

        function createCountrySelector() {
            const container = document.getElementById("country-buttons");
            const countries = [...new Set(colleges.map((c) => c.location.split(", ")[1]))];

            const allBtn = document.createElement("div");
            allBtn.className = "country-btn active";
            allBtn.innerHTML = '<i class="fas fa-globe mr-2"></i> All Countries';
            allBtn.addEventListener("click", () => {
                document.querySelectorAll(".country-btn").forEach((btn) => btn.classList.remove("active"));
                allBtn.classList.add("active");
                activeCountry = null;
                updateMarkerVisibility();
            });
            container.appendChild(allBtn);

            countries.forEach((country) => {
                const college = colleges.find((c) => c.location.includes(country));
                const btn = document.createElement("div");
                btn.className = "country-btn";
                btn.innerHTML = `<img src="${college.flag}" class="flag-icon"> ${country}`;
                btn.addEventListener("click", () => {
                    document.querySelectorAll(".country-btn").forEach((btn) => btn.classList.remove("active"));
                    btn.classList.add("active");
                    activeCountry = country;
                    updateMarkerVisibility();
                    const collegeInCountry = colleges.find((c) => c.location.includes(country));
                    if (collegeInCountry) showCollegeInfo(collegeInCountry);
                });
                container.appendChild(btn);
            });
        }

        function updateMarkerVisibility() {
            markers.forEach((marker) => {
                const college = marker.userData;
                const shouldShow = !activeCountry || college.location.includes(activeCountry);
                marker.visible = shouldShow;
                if (marker.htmlMarker) marker.htmlMarker.style.display = shouldShow ? "block" : "none";
            });
        }

        function addCollegeMarkers() {
            colleges.forEach((college) => {
                const phi = ((90 - college.coordinates.lat) * Math.PI) / 180;
                const theta = ((college.coordinates.lng + 180) * Math.PI) / 180;
                const x = -Math.sin(phi) * Math.cos(theta);
                const y = Math.cos(phi);
                const z = Math.sin(phi) * Math.sin(theta);

                const markerGeometry = new THREE.SphereGeometry(0.02, 16, 16);
                const markerMaterial = new THREE.MeshBasicMaterial({
                    color: 0x3b82f6,
                    transparent: true,
                    opacity: 0.8,
                });
                const markerMesh = new THREE.Mesh(markerGeometry, markerMaterial);
                markerMesh.position.set(x * 1.02, y * 1.02, z * 1.02);
                markerMesh.userData = college;
                scene.add(markerMesh);
                markers.push(markerMesh);

                const htmlMarker = document.createElement("div");
                htmlMarker.className = "marker";
                htmlMarker.dataset.college = college.name;
                document.getElementById("earth-container").appendChild(htmlMarker);

                const tooltip = document.createElement("div");
                tooltip.className = "tooltip";
                tooltip.textContent = college.name;
                htmlMarker.appendChild(tooltip);

                htmlMarker.updatePosition = function () {
                    const vector = new THREE.Vector3().copy(markerMesh.position).project(camera);
                    const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
                    const y = (-vector.y * 0.5 + 0.5) * window.innerHeight;
                    htmlMarker.style.left = x + "px";
                    htmlMarker.style.top = y + "px";

                    const isVisible =
                        vector.z <= 1 &&
                        x >= 0 &&
                        y >= 0 &&
                        x <= window.innerWidth &&
                        y <= window.innerHeight;

                    htmlMarker.style.display = isVisible ? "block" : "none";
                };

                htmlMarker.addEventListener("click", (e) => {
                    e.stopPropagation();
                    showCollegeInfo(college);
                });

                markerMesh.htmlMarker = htmlMarker;
            });
        }

        function showCollegeInfo(college) {
            const infoPanel = document.getElementById("info-panel");
            const collegeInfo = document.getElementById("college-info");
            collegeInfo.innerHTML = `
                <div class="college-name flex items-center">
                    <img src="${college.flag}" class="flag-icon mr-2">${college.name}
                </div>
                <div class="college-location">
                    <i class="fas fa-map-marker-alt mr-2"></i>${college.location}
                </div>
                <div class="college-card">
                    <div class="college-detail">
                        <span class="detail-label">Duration:</span> ${college.duration}
                    </div>
                    <div class="college-detail">
                        <span class="detail-label">Fees:</span> ${college.fees}
                    </div>
                    <div class="college-detail">
                        <span class="detail-label">Eligibility:</span> ${college.eligibility}
                    </div>
                    <div class="mt-3 font-medium text-blue-300">Key Benefits:</div>
                    <ul class="benefits-list">
                        ${college.benefits.map((b) => `<li class="benefit-item">${b}</li>`).join("")}
                    </ul>
                    <div class="mt-4">
                        <a href="${college.website}" target="_blank" class="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 inline-block text-sm">
                            <i class="fas fa-external-link-alt mr-1"></i> Visit Website
                        </a>
                    </div>
                </div>
                <div class="mt-3 text-sm text-gray-300">${college.info}</div>
            `;
            infoPanel.style.display = "block";

            const phi = ((90 - college.coordinates.lat) * Math.PI) / 180;
            const theta = ((college.coordinates.lng + 180) * Math.PI) / 180;
            controls.autoRotate = false;
            controls.target.set(
                -Math.sin(phi) * Math.cos(theta) * 1.02,
                Math.cos(phi) * 1.02,
                Math.sin(phi) * Math.sin(theta) * 1.02
            );
        }

        function searchCollege() {
            const query = document.getElementById("search-input").value.toLowerCase();
            if (!query) return;
            const found = colleges.find((c) =>
                c.name.toLowerCase().includes(query) || c.location.toLowerCase().includes(query)
            );
            if (found) showCollegeInfo(found);
            else alert("No MBBS college found with that name or location.");
        }

        function onCanvasClick(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(markers);
            if (intersects.length > 0) showCollegeInfo(intersects[0].object.userData);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            markers.forEach((marker) => {
                if (marker.htmlMarker) marker.htmlMarker.updatePosition();
            });
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
